<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <title>EPhone OS</title>
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#f0f2f5">
  
  <style>
    /* --- 基础设置 --- */
    * { scrollbar-width: none; -ms-overflow-style: none; }
    *::-webkit-scrollbar { display: none; width: 0; height: 0; }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-tap-highlight-color: transparent;
      background-color: #000; /* 底部背景色，防止动画间隙漏白 */
    }

    /* --- 1. 主屏幕容器 (Home Screen) --- */
    /* 这里融合了 indexhhhh 的结构逻辑 */
    #home-screen {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      /* 保持原来的渐变背景 */
      background-image: linear-gradient(to top, #c471f5 0%, #fa71cd 100%);
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding-bottom: 180px;
      box-sizing: border-box;
      z-index: 10;
      
      /* 关键动画属性：移植自 indexhhhh */
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s;
      transform-origin: center center;
    }

    /* 当 App 打开时，主屏幕缩小变暗 */
    #home-screen.shrunk {
      transform: scale(0.92); /* 稍微缩小 */
      opacity: 0;
      pointer-events: none;
      filter: blur(5px); /* 可选：增加模糊效果 */
    }

    .app-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 40px;
      padding: 20px;
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --- 图标样式 (保持原样) --- */
    .app-icon-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .app-icon-wrapper:active { transform: scale(0.95); }

    .app-icon {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(5px);
    }
    .icon-a { background: linear-gradient(135deg, rgba(255, 154, 158, 0.9) 0%, rgba(254, 207, 239, 0.9) 100%); }
    .icon-b { background: linear-gradient(135deg, rgba(161, 140, 209, 0.9) 0%, rgba(251, 194, 235, 0.9) 100%); }
    
    .app-name {
      font-size: 14px;
      color: #fff;
      font-weight: 500;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* --- 2. App 窗口容器 (App Window) --- */
    /* 移植自 indexhhhh 的核心逻辑 */
    .app-window {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      z-index: 50;
      display: none; /* 默认不渲染 */
      flex-direction: column;
      
      /* 动画初始状态 */
      transform: scale(0.95);
      opacity: 0;
      border-radius: 0; /* 全屏模式通常无需圆角，或者可以设为手机圆角 */
      overflow: hidden;
      
      /* 过渡效果 */
      transition: transform 0.35s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.3s ease;
    }

    .app-window.active {
      display: flex;
      /* 稍微延时加 active 类以触发 transition，JS中处理 */
      transform: scale(1);
      opacity: 1;
    }
    
    /* iframe 填满容器 */
    .app-frame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* --- 3. 悬浮按钮 (FAB) - 保持你原有的逻辑 --- */
    #fab-container {
      position: fixed;
      bottom: calc(30px + env(safe-area-inset-bottom));
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      gap: 15px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, bottom 0.3s, right 0.3s;
      touch-action: none;
    }

    /* 只有打开 APP 时才显示 FAB */
    body.app-open #fab-container {
      opacity: 1;
      pointer-events: auto;
    }

    /* 隐身模式 */
    body.app-open #fab-container.ghost-mode {
      opacity: 0.01;
      left: auto !important;
      top: auto !important;
      bottom: calc(30px + env(safe-area-inset-bottom)) !important;
      right: 20px !important;
    }
    body.app-open #fab-container.ghost-mode .fab-menu { display: none !important; }

    .fab-main {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: rgba(30, 30, 30, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: grab;
      transition: transform 0.3s, background-color 0.3s;
    }
    .fab-main:active { cursor: grabbing; }
    .fab-main.expanded { transform: rotate(90deg); background-color: #ff3b30; }

    .fab-menu {
      display: flex;
      flex-direction: column-reverse;
      gap: 15px;
      opacity: 0;
      transform: translateY(20px) scale(0.8);
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .fab-container.menu-open .fab-menu { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

    .fab-item {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background-color: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      color: #333;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
    }
    .fab-item::after {
      content: attr(data-label);
      position: absolute;
      right: 60px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }
    .fab-container.menu-open .fab-item::after { opacity: 1; }

    svg { width: 24px; height: 24px; fill: currentColor; }

    /* 提示框 */
    #toast-msg {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0,0,0,0.8);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 200;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        text-align: center;
    }
    #toast-msg.show { opacity: 1; }

  </style>
</head>
<body>

  <!-- 主屏幕容器：包含壁纸和图标 -->
  <div id="home-screen">
    <div class="app-grid">
      <div class="app-icon-wrapper" onclick="openApp('window-a')">
        <div class="app-icon icon-a">330</div>
        <span class="app-name">330</span>
      </div>
      <div class="app-icon-wrapper" onclick="openApp('window-b')">
        <div class="app-icon icon-b">兔k</div>
        <span class="app-name">兔k</span>
      </div>
    </div>
  </div>

  <!-- App A 容器 -->
  <div id="window-a" class="app-window">
    <iframe class="app-frame" src="https://cx3300-1.github.io/ooooka/"></iframe>
  </div>

  <!-- App B 容器 -->
  <div id="window-b" class="app-window">
    <iframe class="app-frame" src="https://cx3300-1.github.io/-k-/"></iframe>
  </div>

  <!-- 悬浮按钮 (FAB) -->
  <div id="fab-container" class="fab-container">
    <div class="fab-menu">
      <button class="fab-item" onclick="goHome()" data-label="返回主屏幕">
        <svg viewBox="0 0 24 24"><path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/></svg>
      </button>
      
      <button class="fab-item" onclick="hideFab()" data-label="隐藏按钮" style="color: #666;">
        <svg viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
      </button>

      <button class="fab-item" onclick="openApp('window-b')" data-label="切换到 兔k" style="color: #a18cd1;">兔k</button>
      <button class="fab-item" onclick="openApp('window-a')" data-label="切换到 330" style="color: #ff9a9e;">330</button>
    </div>
    
    <button id="fab-main" class="fab-main">
        <svg viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>
    </button>
  </div>

  <div id="toast-msg">已隐藏。点击屏幕右下角可呼出菜单。</div>

  <script>
    const homeScreen = document.getElementById('home-screen');
    const fabContainer = document.getElementById('fab-container');
    const fabMain = document.getElementById('fab-main');
    const toastMsg = document.getElementById('toast-msg');
    
    // 图标 SVG
    const menuIconSvg = '<svg viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>';
    const closeIconSvg = '<svg viewBox="0 0 24 24"><path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>';

    let currentWindowId = null;

    // 打开 APP (仿 indexhhhh 逻辑)
    function openApp(windowId) {
      const targetWindow = document.getElementById(windowId);
      if (!targetWindow) return;

      // 1. 如果当前已经在另一个APP里，先关闭旧的（为了切换动画流畅，直接切也可以）
      if (currentWindowId && currentWindowId !== windowId) {
        document.getElementById(currentWindowId).classList.remove('active');
        setTimeout(() => { 
           document.getElementById(currentWindowId).style.display = 'none'; 
        }, 300);
      }

      // 2. 激活状态：Home 缩放退出，App 缩放进入
      document.body.classList.add('app-open');
      homeScreen.classList.add('shrunk'); // 添加缩放类

      // 显示新窗口
      targetWindow.style.display = 'flex';
      // 强制重绘，确保 transition 生效
      targetWindow.offsetHeight; 
      targetWindow.classList.add('active');

      // 刷新 iframe (可选)
      const iframe = targetWindow.querySelector('iframe');
      // iframe.src = iframe.src; 

      currentWindowId = windowId;
      closeMenu();
    }

    // 返回主屏幕
    function goHome() {
      if (currentWindowId) {
        const activeWindow = document.getElementById(currentWindowId);
        
        // 1. App 窗口缩小透明
        activeWindow.classList.remove('active');
        
        // 2. 等待动画结束后隐藏 display
        setTimeout(() => {
          activeWindow.style.display = 'none';
        }, 350);
      }

      // 3. Home 屏幕恢复
      homeScreen.classList.remove('shrunk');
      document.body.classList.remove('app-open');
      
      currentWindowId = null;
      closeMenu();
    }

    // --- 以下是 FAB 按钮与隐身逻辑 (保持原版) ---

    function hideFab() {
        closeMenu();
        fabContainer.style.left = '';
        fabContainer.style.top = '';
        fabContainer.style.bottom = 'calc(30px + env(safe-area-inset-bottom))';
        fabContainer.style.right = '20px';
        fabContainer.classList.add('ghost-mode');
        showToast("已隐藏。点击屏幕右下角可呼出。");
    }

    function showFab() {
        fabContainer.classList.remove('ghost-mode');
    }

    function showToast(text) {
        toastMsg.innerText = text;
        toastMsg.classList.add('show');
        setTimeout(() => toastMsg.classList.remove('show'), 3000);
    }

    function toggleMenu() {
      if (fabContainer.classList.contains('ghost-mode')) {
          showFab();
          setTimeout(() => {
              fabContainer.classList.add('menu-open');
              fabMain.classList.add('expanded');
              fabMain.innerHTML = closeIconSvg;
          }, 50);
          return;
      }
      fabContainer.classList.toggle('menu-open');
      fabMain.classList.toggle('expanded');
      fabMain.innerHTML = fabMain.classList.contains('expanded') ? closeIconSvg : menuIconSvg;
    }

    function closeMenu() {
      fabContainer.classList.remove('menu-open');
      fabMain.classList.remove('expanded');
      fabMain.innerHTML = menuIconSvg;
    }

    document.addEventListener('click', (e) => {
      if (!fabContainer.contains(e.target) && fabContainer.classList.contains('menu-open')) {
        closeMenu();
      }
    });

    // 拖拽逻辑
    let isDragging = false, hasMoved = false;
    let startX, startY, initialLeft, initialTop;
    const dragThreshold = 5; 

    fabMain.addEventListener('mousedown', startDrag);
    fabMain.addEventListener('touchstart', startDrag, {passive: false});

    function startDrag(e) {
        if (fabContainer.classList.contains('ghost-mode')) return;
        if (fabContainer.classList.contains('menu-open')) closeMenu();

        isDragging = true;
        hasMoved = false; 
        const point = e.touches ? e.touches[0] : e;
        startX = point.clientX;
        startY = point.clientY;

        const rect = fabContainer.getBoundingClientRect();
        initialLeft = rect.left;
        initialTop = rect.top;

        fabContainer.style.bottom = 'auto';
        fabContainer.style.right = 'auto';
        fabContainer.style.left = initialLeft + 'px';
        fabContainer.style.top = initialTop + 'px';

        document.addEventListener('mousemove', onDrag);
        document.addEventListener('touchmove', onDrag, {passive: false});
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
    }

    function onDrag(e) {
        if (!isDragging) return;
        e.preventDefault(); 
        const point = e.touches ? e.touches[0] : e;
        const deltaX = point.clientX - startX;
        const deltaY = point.clientY - startY;

        if (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold) hasMoved = true;
        fabContainer.style.left = (initialLeft + deltaX) + 'px';
        fabContainer.style.top = (initialTop + deltaY) + 'px';
    }

    function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
        document.removeEventListener('touchend', stopDrag);
    }

    fabMain.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!hasMoved) toggleMenu();
    });
  </script>
</body>
</html>
