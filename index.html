<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="theme-color" content="#f0f2f5">
  <title>PWA Demo</title>
  <style>
    :root {
      --screen-width: 350px;
      --screen-height: 650px;
    }

    /* 全局隐藏滚动条 */
    * { scrollbar-width: none; -ms-overflow-style: none; }
    *::-webkit-scrollbar { display: none; width: 0; height: 0; }

    html {
      -webkit-text-size-adjust: 100%;
      height: 100%;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      font-weight: normal;
      background-color: #f0f2f5;
      height: 100%;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* --- 1. 启动器主屏幕 --- */
    #launcher-screen {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      /* 背景方案: 梦幻紫粉渐变 */
      background-image: linear-gradient(to top, #c471f5 0%, #fa71cd 100%);
      background-size: cover;
      background-position: center;
      justify-content: flex-end;
      padding-bottom: 180px;
      box-sizing: border-box;
    }

    #launcher-screen.hidden {
      transform: scale(1.1);
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s ease;
    }

    .app-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 40px;
      padding: 20px;
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .app-icon-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: transform 0.1s;
      -webkit-tap-highlight-color: transparent;
    }

    .app-icon-wrapper:active {
      transform: scale(0.95);
    }

    .app-icon {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(5px);
    }

    .icon-a { background: linear-gradient(135deg, rgba(255, 154, 158, 0.9) 0%, rgba(254, 207, 239, 0.9) 100%); }
    .icon-b { background: linear-gradient(135deg, rgba(161, 140, 209, 0.9) 0%, rgba(251, 194, 235, 0.9) 100%); }

    .app-name {
      font-size: 14px;
      color: #fff;
      font-weight: 500;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      letter-spacing: 0.5px;
    }

    /* --- 2. iframe 容器 --- */
    .app-frame {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      background-color: #fff;
      opacity: 0;
      visibility: hidden;
      z-index: 1;
      transition: opacity 0.3s ease;
      display: block;
    }

    .app-frame.active {
      opacity: 1;
      visibility: visible;
      z-index: 50;
    }

    /* --- 3. 悬浮按钮 (FAB) --- */
    #fab-container {
      position: fixed;
      /* 初始位置固定在右下角 */
      bottom: calc(30px + env(safe-area-inset-bottom));
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      gap: 15px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, bottom 0.3s, right 0.3s; /* 增加位置过渡动画 */
      touch-action: none;
    }

    /* 正常显示状态 */
    body.app-open #fab-container {
      opacity: 1;
      pointer-events: auto;
    }

    /* [新增] 隐身模式 (Ghost Mode) */
    body.app-open #fab-container.ghost-mode {
        opacity: 0.01; /* 几乎完全透明，但保留点击能力 */
        /* 强制回到右下角，方便用户盲按 */
        left: auto !important;
        top: auto !important;
        bottom: calc(30px + env(safe-area-inset-bottom)) !important;
        right: 20px !important;
    }
    
    /* 隐身模式下隐藏菜单项，只留主按钮响应点击 */
    body.app-open #fab-container.ghost-mode .fab-menu {
        display: none !important;
    }

    .fab-main {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: rgba(30, 30, 30, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: grab;
      transition: transform 0.3s, background-color 0.3s;
      -webkit-tap-highlight-color: transparent;
    }
    
    .fab-main:active { cursor: grabbing; }

    .fab-main.expanded {
      transform: rotate(90deg);
      background-color: #ff3b30;
    }

    .fab-menu {
      display: flex;
      flex-direction: column-reverse;
      gap: 15px;
      opacity: 0;
      transform: translateY(20px) scale(0.8);
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .fab-container.menu-open .fab-menu {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .fab-item {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background-color: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      color: #333;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      position: relative;
      -webkit-tap-highlight-color: transparent;
    }

    .fab-item::after {
      content: attr(data-label);
      position: absolute;
      right: 60px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
      font-family: -apple-system, sans-serif;
    }

    .fab-container.menu-open .fab-item::after { opacity: 1; }
    .fab-item:active { transform: scale(0.9); }

    svg { width: 24px; height: 24px; fill: currentColor; }

    /* [新增] 临时提示框样式 */
    #toast-msg {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0,0,0,0.8);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 200;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        text-align: center;
        width: 80%;
        max-width: 300px;
    }
    #toast-msg.show { opacity: 1; }

  </style>
</head>
<body>

  <div id="launcher-screen">
    <div class="app-grid">
      <div class="app-icon-wrapper" onclick="openApp('frame-a')">
        <div class="app-icon icon-a">330</div>
        <span class="app-name">330</span>
      </div>
      <div class="app-icon-wrapper" onclick="openApp('frame-b')">
        <div class="app-icon icon-b">兔k</div>
        <span class="app-name">兔k</span>
      </div>
    </div>
  </div>

  <iframe id="frame-a" class="app-frame" src="https://cx3300-1.github.io/ooooka/"></iframe>
  <iframe id="frame-b" class="app-frame" src="https://cx3300-1.github.io/-k-/"></iframe>

  <div id="fab-container" class="fab-container">
    <div class="fab-menu">
      <button class="fab-item" onclick="goHome()" data-label="返回主屏幕">
        <svg viewBox="0 0 24 24"><path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/></svg>
      </button>
      
      <button class="fab-item" onclick="hideFab()" data-label="隐藏按钮" style="color: #666;">
        <svg viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
      </button>

      <button class="fab-item" onclick="openApp('frame-b')" data-label="切换到 兔k" style="color: #a18cd1;">兔k</button>
      <button class="fab-item" onclick="openApp('frame-a')" data-label="切换到 330" style="color: #ff9a9e;">330</button>
    </div>
    
    <button id="fab-main" class="fab-main">
        <svg viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>
    </button>
  </div>

  <div id="toast-msg">已隐藏。点击屏幕右下角可呼出菜单。</div>

  <script>
    const fabContainer = document.getElementById('fab-container');
    const fabMain = document.getElementById('fab-main');
    const launcherScreen = document.getElementById('launcher-screen');
    const frames = document.querySelectorAll('.app-frame');
    const toastMsg = document.getElementById('toast-msg');

    // 图标定义
    const menuIconSvg = '<svg viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"/></svg>';
    const closeIconSvg = '<svg viewBox="0 0 24 24"><path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>';

    function openApp(frameId) {
      document.body.classList.add('app-open');
      launcherScreen.classList.add('hidden');
      frames.forEach(frame => {
        if (frame.id === frameId) {
          frame.classList.add('active');
          frame.src = frame.src; 
        } else {
          frame.classList.remove('active');
        }
      });
      closeMenu();
    }

    function goHome() {
      document.body.classList.remove('app-open');
      launcherScreen.classList.remove('hidden');
      setTimeout(() => {
        frames.forEach(frame => frame.classList.remove('active'));
      }, 300);
      closeMenu();
      
      // 回到主页时，如果处于隐身模式，自动恢复显示（可选）
      // showFab(); 
    }

    // --- [新增] 隐藏功能 ---
    function hideFab() {
        closeMenu();
        // 1. 复位到右下角 (重置 style 属性)
        fabContainer.style.left = '';
        fabContainer.style.top = '';
        fabContainer.style.bottom = 'calc(30px + env(safe-area-inset-bottom))';
        fabContainer.style.right = '20px';
        
        // 2. 开启隐身模式类
        fabContainer.classList.add('ghost-mode');
        
        // 3. 显示提示
        showToast("已隐藏。点击屏幕右下角可呼出。");
    }

    // 恢复显示
    function showFab() {
        fabContainer.classList.remove('ghost-mode');
    }

    function showToast(text) {
        toastMsg.innerText = text;
        toastMsg.classList.add('show');
        setTimeout(() => {
            toastMsg.classList.remove('show');
        }, 3000);
    }

    function toggleMenu() {
      // 如果处于隐身模式，点击主按钮就是“现身”
      if (fabContainer.classList.contains('ghost-mode')) {
          showFab();
          // 现身的同时直接展开菜单，体验更流畅
          setTimeout(() => {
              fabContainer.classList.add('menu-open');
              fabMain.classList.add('expanded');
              fabMain.innerHTML = closeIconSvg;
          }, 50);
          return;
      }

      fabContainer.classList.toggle('menu-open');
      fabMain.classList.toggle('expanded');
      
      if (fabMain.classList.contains('expanded')) {
        fabMain.innerHTML = closeIconSvg;
      } else {
        fabMain.innerHTML = menuIconSvg;
      }
    }

    function closeMenu() {
      fabContainer.classList.remove('menu-open');
      fabMain.classList.remove('expanded');
      fabMain.innerHTML = menuIconSvg;
    }

    document.addEventListener('click', (e) => {
      // 只有在菜单打开且点击外部时才关闭
      // 如果是隐身模式点击了空白处，不需要做任何事
      if (!fabContainer.contains(e.target) && fabContainer.classList.contains('menu-open')) {
        closeMenu();
      }
    });

    // --- 拖拽功能 (保持不变，加了隐身判断) ---
    let isDragging = false;
    let hasMoved = false;
    let startX, startY, initialLeft, initialTop;
    const dragThreshold = 5; 

    fabMain.addEventListener('mousedown', startDrag);
    fabMain.addEventListener('touchstart', startDrag, {passive: false});

    function startDrag(e) {
        // 如果是隐身模式，禁止拖拽，只允许点击
        if (fabContainer.classList.contains('ghost-mode')) {
            return;
        }

        if (fabContainer.classList.contains('menu-open')) {
            closeMenu();
        }

        isDragging = true;
        hasMoved = false; 

        if (e.type === 'touchstart') {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        } else {
            startX = e.clientX;
            startY = e.clientY;
        }

        const rect = fabContainer.getBoundingClientRect();
        initialLeft = rect.left;
        initialTop = rect.top;

        fabContainer.style.bottom = 'auto';
        fabContainer.style.right = 'auto';
        fabContainer.style.left = initialLeft + 'px';
        fabContainer.style.top = initialTop + 'px';

        document.addEventListener('mousemove', onDrag);
        document.addEventListener('touchmove', onDrag, {passive: false});
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
    }

    function onDrag(e) {
        if (!isDragging) return;
        e.preventDefault(); 

        let clientX, clientY;
        if (e.type === 'touchmove') {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        const deltaX = clientX - startX;
        const deltaY = clientY - startY;

        if (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold) {
            hasMoved = true;
        }

        fabContainer.style.left = (initialLeft + deltaX) + 'px';
        fabContainer.style.top = (initialTop + deltaY) + 'px';
    }

    function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
        document.removeEventListener('touchend', stopDrag);
    }

    fabMain.addEventListener('click', (e) => {
        e.stopPropagation();
        // 无论是拖拽结束还是普通点击，如果没有发生位移，都视为点击
        // 注意：如果是 Ghost Mode，startDrag 会直接返回，isDragging为false，点击事件依然触发，这里正好处理
        if (!hasMoved) {
            toggleMenu();
        }
    });

  </script>
</body>
</html>
